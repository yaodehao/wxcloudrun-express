function SDK_start(){	window.dd.ready(()=>{	g_log+='\n*进入dd.ready内'; 	app.ShowBusy('钉钉Ready内！');			window.dd.error((err)=>{dd_MainErr('dd.config错误:',JSON.stringify(err));})			dd_config();		setTimeout(()=>{dd_AuthCode()},500); //免登认证		})//dd.ready}	function dd_config(){	g_log+='\n*申请Signature'; 	app.ShowBusy('钉钉Config配置中！');		axios.post('/signature.asp?indexQS='+indexQS+'&appSN='+appSN).then((response)=>{	g_log+='\n*postSignReturn'; 		if(response.data.IsSuccess){	g_log+='\n*GetSignature成功,准备Config:'+response.data.signature;								window.dd.config({corpId: g_corpId,	agentId:297356936,	type:0,   //0微应用的jsapi,1服务窗的jsapi；不填默认0		    	timeStamp:response.data.timeStamp,nonceStr :response.data.nonceStr,signature:response.data.signature,		    			    	jsApiList :['biz.ding.post','biz.util.openLink','biz.contact.choose','biz.chat.openSingleChat',		        		        'biz.telephone.call','biz.telephone.showCallMenu','biz.conference.videoConfCall','biz.telephone.quickCallList',		        'device.geolocation.get','biz.map.search','biz.map.locate','biz.map.view','device.geolocation.start','device.geolocation.stop',		        'biz.util.uploadImage','biz.util.uploadImageFromCamera','biz.util.uploadAttachment','biz.contact.complexPicker','biz.ding.create',		        'runtime.permission.requestAuthCode'		    ]}); //window.dd.config			    g_log+='\n *config 函数后';					    		}else{dd_MainErr('signature获取签名错误:',response.data.Message); }}).catch((err)=>{dd_MainErr('post-sign.asp错误:',JSON.stringify(err));});//axios.post.signature}function dd_AuthCode(){g_log+='\n*准备requestAuthCode:'+g_corpId;	app.ShowBusy('钉钉AuthCode认证中！!');		window.dd.runtime.permission.requestAuthCode({  corpId: g_corpId	+'',        onSuccess: (DDres)=>{g_log+='\n*AuthCode成功,准备Post:'+DDres.code; 			axios.post('/DDAuth.asp?code='+DDres.code).then(				(response)=>{if(response.data.IsSuccess){g_log+='\n* PostDDAuth.asp成功'; dd_getSession();								}else{dd_MainErr('DDAuth.asp不通过:',response.data); }}			).catch((err)=>{dd_MainErr('post_DDAuth错误！',err);})//post DDAuth        },//requestAuthCode_onSuccess        onFail:(err)=>{dd_MainErr('requestAuthCode有误:',JSON.stringify(err));}      })		//requestAuthCode 		g_log+='\n* requestAuthCode函数后';}function dd_getSession(){g_log+='\n*准备PostGetSession'; 	app.ShowBusy('设置Session参数！');	axios.post('/getSession.asp?appSN='+appSN).then((response)=>{g_log+='\n*GetSession成功:' +response.data.username;		//alert(JSON.stringify(response.data));		app.ACC=response.data.ACC;  g_mem_ID=response.data.mem_ID;g_dw_name=response.data.dw_name;		g_truename=response.data.truename; app.truename=g_truename;		g_logo=response.data.d_pic; app.logo=g_logo; 		g_logintype=response.data.logintype;				g_ddConfigOK=true;					app.LoadVue('系统首页',homepage);		//dd_config(); //		updateGPS();//上传一次GPS		app.postLog('登录','钉钉登录');		app.ShowBusy('钉钉认证完成！'); app.HideBusy();  //setTimeout(()=>{ app.HideBusy()},1000);	}).catch((err)=>{dd_MainErr('post-getSession错误:',JSON.stringify(err)); });//axios.post.then.catch		}//-----------ready  之后函数------------function isDDReady(){	if(navigator.userAgent.indexOf('DingTalk')<0){app.ShowSnack('请在钉钉或企业微信中使用该功能！','warning');return false}	if(g_ddConfigOK){return true}else{dd_MainErr('钉钉授权未完成，建议重新进入！\n','');return false}}//dd_alert('钉钉授权未完成！建议重新从钉钉客户端进入！'+g_log); 	window.dd.biz.navigation.close();  alert(tips+'\n'+JSON.stringify(err)+g_log);function dd_MainErr(tips,err){  g_ddConfigOK=false;	g_log+=tips+'\n '+JSON.stringify(err); alert(g_log); 								location.replace('/dd_exit.asp?appSN='+appSN+'&msg='+g_log); }//视频会议。2.10.3才有，会议与培训,不支持PC， https://ding-doc.dingtalk.com/doc#/dev/zkcz8m，//vt_living判断是钉钉后引用function SdkMeeting(Title,uids,dtype,save){if(!isDDReady()){return 0};		var StaffIds= (uids==null)? [] :uids.split('、'); 	StaffIds.pop(); 	//alert(JSON.stringify(StaffIds));	window.dd.biz.conference.videoConfCall({    		title:Title, 	calleeCorpId:g_corpId,		   calleeStaffIds: StaffIds,    		onSuccess:()=>{},    	onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }})}//vt_meeting引用function SdkMeetingObj(obj){if(!isDDReady()){return 0};	var StaffIds=[]	; 	//alert(JSON.stringify(obj)); return 0;	if(obj.d_uids==''){app.myAlert('呼叫对象微信ID为空！');return 0; 	//StaffIds=[];	}else if(obj.d_uids.indexOf('、')>0){StaffIds=obj.d_uids.split('、'); 	StaffIds.pop(); //去掉后面一个	}else{ StaffIds=[obj.d_uids];}	//数组只有一个数值	window.dd.biz.conference.videoConfCall({    		title:obj.d_title, 	calleeCorpId:g_corpId,		   calleeStaffIds: StaffIds,    		onSuccess:(res)=>{//ShowJson(res)    			if(obj.save==0){}	        	else{app.Json2DB('/common/data_s.asp?r_tab=cm_meeting&r_fd1=d_title$d_names$vid$TopTab$d_cat&r_fd0=TopRow',obj);}	    		},    		onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }})}//一键呼叫，接通后还可增加人 https://ding-doc.dingtalk.com/doc#/dev/afrr0d#a-namenpqfunction quickCall(tel,t,c){ if(!isDDReady()){return 0}  	window.dd.biz.telephone.quickCallList({title:t,	content:c,corpId:g_corpId,    	phoneNumber :tel,   	typeList : [1,3,5],	    	onSuccess:()=>{},   onFail:(err)=>{dd_alert("quickCallList错误:"+JSON.stringify(err)); }})}function selectUser(obj){if(!isDDReady()){return 0};	var StaffIds=[]	; 	//alert(JSON.stringify(obj)); return 0;	if(typeof(obj.d_uids)=='undefined'||obj.d_uids==''){StaffIds=[];	}else if(obj.d_uids.indexOf('、')>0){StaffIds=obj.d_uids.split('、'); 	StaffIds.pop(); //去掉后面一个	}else{ StaffIds=[obj.d_uids];}	//数组只有一个数值		dd.biz.contact.complexPicker({corpId:g_corpId, appId:297356936, 	title:"选择人员",   	                		multiple:true,limitTips:"超出了人数",maxUsers:1000,		pickedUsers:StaffIds, pickedDepartments:[],disabledUsers:[],disabledDepartments:[],//不可选部门		requiredUsers:[],requiredDepartments:[],//必选部门（不可取消选中状态）		permissionType:"GLOBAL",//可添加权限校验，选人权限，目前只有GLOBAL这个参数		responseUserOnly:true,startWithDepartmentId:0,	    onSuccess: (result)=>{		    obj.d_uids='';obj.d_names='';		    var selectedUser=result.users;            for (var i=0; i<selectedUser.length; i++){obj.d_uids+=selectedUser[i].emplId+'、';obj.d_names+=selectedUser[i].name+'、';}       },   onFail :  (err)=>{}});} //预览图片    function openPic(url){ url=g_url+url;	dd.biz.util.previewImage({current: url, 	urls: [url] });	} //为字段上传照片,crud_method中photo4fd(fd)调用function photo4fd(obj,fd){if(!isDDReady()){return 0};		wx.chooseImage({	count:1,		sizeType:['original', 'compressed'],	sourceType:['album','camera'],		success: (res)=> {						var localId0 = res.localIds.pop();					wx.uploadImage({						localId: localId0,		isShowProgressTips: 1,						success: (res)=> {//alert(res.serverId);返回服务器端mid																axios.post("/common/GetFileFromQYWX.asp",qs.stringify({mid:res.serverId})).then(response=>{										 obj.editedItem[fd]=response.data.src;   //赋值给字段alert(response.data.src);										 obj.EditDialog=false;obj.EditDialog=true;//强制刷新														}).catch((err)=>{app.ShowAlert('warning','保存照片失败：',err); })							},//upload_success					}); //wx.uploadImage			}//chooseImage success	});} //为字段选择用户function user4fd(obj,fd){if(!isDDReady()){return 0};	var StaffIds=[]	; 	//alert(JSON.stringify(obj)); return 0;	if(obj.editedItem[fd]==''){StaffIds=[];	}else if(obj.editedItem[fd].indexOf('、')>0){StaffIds=obj.editedItem[fd].split('、'); 	StaffIds.pop(); //去掉后面一个	}else{ StaffIds=[obj.editedItem[fd]];}	//数组只有一个数值		dd.biz.contact.complexPicker({corpId:g_corpId, appId:297356936, 	title:"选择人员",   	                		multiple:true,limitTips:"超出了人数",maxUsers:1000,		pickedUsers:StaffIds, pickedDepartments:[],disabledUsers:[],disabledDepartments:[],//不可选部门		requiredUsers:[],requiredDepartments:[],//必选部门（不可取消选中状态）		permissionType:"GLOBAL",//可添加权限校验，选人权限，目前只有GLOBAL这个参数		responseUserOnly:true,startWithDepartmentId:0,	    onSuccess: (result)=>{		    obj.editedItem[fd]='';obj.editedItem[fd+'_name']='';		    var selectedUser=result.users;            for (var i=0; i<selectedUser.length; i++){obj.editedItem[fd]+=selectedUser[i].emplId+'、';obj.editedItem[fd+'_name']+=selectedUser[i].name+'、';}            obj.EditDialog=false;obj.EditDialog=true;    },   onFail :  (err)=>{}});} function selectUserEx(obj){if(!isDDReady()){return 0};	}  function sendDing(uids,title){if(!isDDReady()){return 0};	if(!app.browserDD){app.myAlert('请在钉钉中使用该功能！');return 0};var StaffIds= (uids==null)? [] :uids.split('、'); 	StaffIds.pop(); 	//alert(JSON.stringify(StaffIds));dd.biz.ding.create({corpId:g_corpId,    users :StaffIds,// 用户数组      //type: 1, // 附件类型 1：image  2：link    alertType: 2, 	// 钉发送方式 0:电话, 1:短信, 2:应用内       text:title,  bizType :0,	 // 业务类型 0：通知DING；1：任务；2：会议；     onSuccess:(res)=>{}, onFail:(res)=>{} //ShowJson(res)    })}  //仅仅网络呼叫function videoCall(tel,t,c){ 	if(!isDDReady()){return 0} 		window.dd.biz.telephone.quickCallList({	phoneNumber :tel,title:t,	content:c, 	typeList:[1,5],corpId:g_corpId,    		onSuccess:()=>{},   onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }  }) }    		function dd_alert(msg){ 	if(!g_ddConfigOK){app.myAlert(msg)}	else{window.dd.device.notification.alert({message:msg,title:"温馨提示（dd_alert）",buttonName:"知道了",onFail:(err)=>{alert("fail:"+JSON.stringify(err));}})}}function myGPS(type,setValue){if(!isDDReady()){return 0}  //获取我的位置，setValue==0打开地图，其他 赋值给app.cur_obj.editedItem，	window.dd.device.notification.showPreloader({text: "使劲定位中..",showIcon: true });	window.dd.device.geolocation.get({ targetAccuracy : 20,    coordinate : type,  withReGeocode : true,    	useCache:true, //默认是true，如果需要频繁获取地理位置，请设置false。 coordinate=1 高德，0gps    onSuccess:result=>{window.dd.device.notification.hidePreloader();  //alert(result.longitude);    		if(result.longitude==0){dd_alert('无法获取定位信息，请确认您的手机已打开定位功能！'); return 0}	    	           	if(setValue==0){openMap(g_truename+':'+result.address,result.latitude,result.longitude); 	//setValue==0打开地图展示当前位置           					axios.post('/common/updateGps.asp?lng='+result.longitude+'&lat='+result.latitude)}                     	else if(typeof(app.cur_obj.editedItem)!="undefined"){app.cur_obj.editedItem.d_lat=''+result.latitude;     					app.cur_obj.editedItem.d_lng=''+result.longitude;	app.cur_obj.editedItem.d_addr=result.address;    					app.cur_obj.EditDialog=false;app.cur_obj.EditDialog=true;}},    onFail:   (err)=>{window.dd.device.notification.hidePreloader();  dd_alert("myGPS获取错误:"+JSON.stringify(err)); }   } );}function updateGPS(){	//上传一次GPS	window.dd.device.geolocation.get({ targetAccuracy:20,    coordinate:1,  withReGeocode:true, useCache:true,     	onSuccess:result=>{var ls_url='/common/updateGps.asp?lng='+result.longitude+'&lat='+result.latitude; //alert(ls_url);    			axios.post(ls_url).then(response=>{}).catch((err)=>{	})},      } )	}   function getLoc(sc){if(!isDDReady()){return 0}	var lat=23.178856;	var lng=114.296302;	if(typeof(app.cur_obj.editedItem)!="undefined"){lat=app.cur_obj.editedItem.d_lat;lng=app.cur_obj.editedItem.d_lng;}	window.dd.biz.map.locate({  	  	latitude: lat,    	longitude: lng,    	scope: sc,	//范围   	 	onSuccess: result=>{								// dd_alert(JSON.stringify(result));	//数据结构	   	 	if(typeof(app.cur_obj.editedItem)!="undefined"){app.cur_obj.editedItem.d_lat=''+result.latitude;     					app.cur_obj.editedItem.d_lng=''+result.longitude;	app.cur_obj.editedItem.d_addr=result.city+result.adName+result.snippet+result.title;    					app.cur_obj.EditDialog=false;app.cur_obj.EditDialog=true;}    				},    	onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }});}function geoStart(){if(!isDDReady()){return 0} //上传与保存定位信息	window.dd.device.notification.showPreloader({text: "使劲定位中..",showIcon: true });	window.dd.device.geolocation.start({targetAccuracy:20,iOSDistanceFilter:200,useCache:true,withReGeocode:false,callBackInterval:5000,sceneId: '750724',     onSuccess : result=>{app.geostart=true;	app.geocount++;	    		if(app.geocount==1){app.ShowSnack('定位信息自动上报已经开启！','warning');window.dd.device.notification.hidePreloader();}    		//app.ShowSnack('定位次数：'+app.geocount);     		if(result.longitude==0){app.ShowSnack('无法获取定位信息，请确认您的手机已打开定位功能！','warning') ; return 0 ;}	    	axios.post('/common/updateGps.asp?lng='+result.longitude+'&lat='+result.latitude).then(response=>{}	).catch((err)=>{})     			    },   onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); window.dd.device.notification.hidePreloader();}});}function geoStop(){if(!isDDReady()){return 0}window.dd.device.geolocation.stop({sceneId: '750724',	onSuccess:()=>{app.geostart=false; app.ShowSnack('已取消定位信息上报！定位次数：'+app.geocount);	app.geocount=0;},	onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }});}//打开地图function openMap(t,lat,lng){if(!isDDReady()){return 0}	window.dd.biz.map.view({latitude:lat, longitude:lng,	title:t,    	onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }})}function sendMsg(gonghao){ if(!isDDReady()){return 0}	window.dd.biz.chat.openSingleChat({    	corpId: g_corpId,     	userId:gonghao, // 用户的工号    	onSuccess:()=>{},onFail:(err)=>{dd_alert("fail:"+JSON.stringify(err)); }})}function uploadPic(num){	window.dd.biz.util.uploadImage({multiple:true, max:num,	onSuccess: result=>{alert(JSON.stringify(result))},	onFail:(err)=>{dd_alert("上传图片失败:"+JSON.stringify(err))}	}); }function uploadCam(num){	window.dd.biz.util.uploadImageFromCamera({compression:true,	onSuccess: result=>{alert(JSON.stringify(result))},	onFail:(err)=>{dd_alert("拍照上传失败:"+JSON.stringify(err))}	}); }function uploadFile(num){	window.dd.biz.util.uploadAttachment({	onSuccess: result=>{alert(JSON.stringify(result))},	onFail:(err)=>{dd_alert("文件上传失败:"+JSON.stringify(err))}	}); }function mapByArr(){	var myurl="http://hmxx.0752app.cn/common/lbs_mapByArr.asp";	if(g_ddConfigOK){window.dd.biz.util.openLink({url:myurl})}	else{app.OpenIfr('调度地图',myurl)}	}